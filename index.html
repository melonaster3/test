<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>갤럭시 A16 자급제</title>
    <!-- Queue-it 트리거에 사용되는 변수 -->
    <script>
      var storeTrigger = false;
      var addOnTrigger = false;
      var waitingRoomName = "";
    </script>
    <!-- 큐잇 클라이언트 JS SDK -->
    <script src="https://static.queue-it.net/script/queueclient.min.js"></script>
    <script
      data-queueit-c="saletest"
      src="https://static.queue-it.net/script/queueconfigloader.min.js"
    ></script>
    <!-- CSS 스타일 -->
    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 20px;
        background: #f5f5f5;
      }
      .container {
        display: flex;
        max-width: 1200px;
        margin: auto;
        background: white;
        padding: 20px;
        gap: 20px;
      }
      .left-panel {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }
      .thumbs {
        display: flex;
        flex-direction: column;
        gap: 5px;
      }
      .thumbs img {
        width: 40px;
        height: 60px;
        object-fit: cover;
        border: 1px solid #ccc;
      }
      .main-img img {
        width: 250px;
        height: 400px;
        object-fit: cover;
        border: 1px solid #ccc;
      }
      .right-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      .right-panel h1 {
        font-size: 24px;
        margin: 0;
      }
      .price {
        font-size: 20px;
        font-weight: bold;
        color: #1e1e1e;
      }
      .button {
        padding: 10px 20px;
        background: black;
        color: white;
        border: none;
        cursor: pointer;
      }
      .button.secondary {
        background: #f0f0f0;
        color: black;
      }
      .options {
        display: flex;
        gap: 10px;
        margin: 10px 0;
      }
      .option-box {
        border: 1px solid #ccc;
        padding: 8px;
        cursor: pointer;
      }
      .option-box.selected {
        background-color: #e0e0e0;
        border-color: #888;
      }
      .section {
        padding: 10px 0;
        border-top: 1px solid #ddd;
      }
      .footer-bar {
        position: fixed;
        bottom: 0;
        left: 0;
        width: 100%;
        background-color: white;
        border-top: 1px solid #ccc;
        padding: 10px 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
        z-index: 1000;
        box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.05);
      }
      .footer-info {
        font-size: 14px;
        margin-left: 10px;
      }
      .footer-button {
        background-color: #000;
        color: white;
        border: none;
        padding: 10px 20px;
        font-size: 16px;
        border-radius: 4px;
        margin-right: 10px;
        cursor: pointer;
      }
      .footer-button:disabled {
        background-color: #ccc;
        color: #666;
        cursor: not-allowed;
      }
      #popup {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.5);
      }
      #popup-content {
        background-color: #fff;
        margin: 15% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 300px;
        text-align: center;
        border-radius: 10px;
      }
      #popup-content form {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }
      #close-popup {
        background-color: #007bff;
        color: white;
        border: none;
        padding: 10px 20px;
        cursor: pointer;
        border-radius: 5px;
      }
      .visually-hidden {
        position: absolute;
        width: 1px;
        height: 1px;
        margin: -1px;
        padding: 0;
        overflow: hidden;
        clip: rect(0 0 0 0);
        border: 0;
      }
    </style>
  </head>
  <body>
    <form id="phone-form">
      <div class="container">
        <div class="left-panel">
          <div class="main-img">
            <img
              src="https://images.samsung.com/kdp/goods/2024/11/21/f5b9afd8-92ec-4ec7-8f85-783ad41f7382.png?$PD_GALLERY_L_PNG$"
              alt="Galaxy A16"
            />
          </div>
          <div class="thumbs">
            <img
              src="https://images.samsung.com/kdp/goods/2024/11/21/f5b9afd8-92ec-4ec7-8f85-783ad41f7382.png?$PD_GALLERY_L_PNG$"
              alt="thumb1"
            />
          </div>
        </div>
        <div class="right-panel">
          <h1>갤럭시 A16 자급제</h1>
          <div class="price">₩293,000</div>
          <div class="section">
            <label>색상:</label>
            <div class="options" id="color-options">
              <label class="option-box">
                <input
                  type="radio"
                  name="color"
                  value="블랙"
                  required
                  class="visually-hidden"
                />
                블랙
              </label>
              <label class="option-box">
                <input
                  type="radio"
                  name="color"
                  value="그린"
                  required
                  class="visually-hidden"
                />
                그린
              </label>
            </div>
          </div>
          <div class="section">
            <label>저장 용량:</label>
            <div class="options" id="storage-options">
              <label class="option-box">
                <input
                  type="radio"
                  name="storage"
                  value="64GB"
                  required
                  class="visually-hidden"
                />
                64GB
              </label>
              <label class="option-box">
                <input
                  type="radio"
                  name="storage"
                  value="128GB"
                  required
                  class="visually-hidden"
                />
                128GB
              </label>
            </div>
          </div>
          <div class="">
            <button class="button">장바구니 담기</button>
            <button
              class="button secondary"
              type="button"
              onclick="openPopUp()"
            >
              매장 픽업
            </button>
          </div>
          <div class="section">
            <p>배송: 일반배송</p>
            <p>결제 혜택: 삼성카드 결제시 최대 5% 할인</p>
          </div>
        </div>
      </div>
      <!-- Footer Bar -->
      <div class="footer-bar">
        <div class="footer-info">
          <strong>갤럭시 A16 자급제</strong><br />
          ₩293,000 | 무료배송
        </div>
        <button
          class="footer-button"
          type="button"
          id="buy-button"
          disabled
          onclick="verifyAccount(event)"
        >
          구매하기
        </button>
      </div>
    </form>
    <div id="popup">
      <div id="popup-content">
        <label>매장을 찾으세요</label>
        <input
          type="search"
          name="storeSearch"
          placeholder="매장명을 입력하세요"
          required
        />
        <button onclick="closePopUp()">닫기</button>
      </div>
    </div>
    <!-- Scripts -->
    <script>
      // 사용자가 Queue-it을 통과했는지 확인하는 함수
      // 대기실에서 온 사용자는 필요한 파라미터와 함께 리디렉션됨
      // qite는 대기실 이름이므로, 이를 확인하면 어떤 대기실 에서 왔는지 알 수 있음
      // 현재 페이지에서는 적용되는 대기실이 2개이니, 체크해야함
      function areQueueItParamsPresent() {
        const requiredParams = [
          "qitq",
          "qitp",
          "qitts",
          "qitc",
          "qite",
          "qitrt",
          "qith",
        ];
        const urlParams = new URLSearchParams(window.location.search);
        if (
          requiredParams.every(
            (param) => urlParams.has(param) && urlParams.get(param) !== ""
          )
        ) {
          waitingRoomName = urlParams.get("qite");
          return true;
        }
        return false;
      }

      // 매장 찾기 버튼이 실행하는 함수
      function openPopUp() {
        if (
          // 큐잇 클라이언트가 사용 가능한 경우
          typeof QueueIt !== "undefined" &&
          typeof QueueIt.validateUser === "function"
        ) {
          const wasUserAlreadyQueued = window.myQueueClient != null;
          storeTrigger = true; // 매장찾기 대기실 에 대한 트리거, 활성화됨
          addOnTrigger = false; // AddOn에 대한 트리거, 비활성화됨
          restoreDate();
          saveLocalStorage();
          QueueIt.validateUser(); // 규칙이 일치하면 결국 open()을 호출함
          // 일치하는 큐 트리거가 없고 큐잇 클라이언트가 생성되지 않았다면, 수동으로 오픈을 호출함
          const isUserQueuedAfterValidation = window.myQueueClient != null;
          if (!wasUserAlreadyQueued && !isUserQueuedAfterValidation) {
            open();
          }
        }
        // Queue-it 클라이언트가 존재하지 않는 경우, 일반 동작 방식으로 작동함
        else {
          open();
        }
      }
      // 팝업 열게 하는 함수
      function open() {
        document.getElementById("popup").style.display = "block";
      }
      // 팝업 닫게 하는 함수
      function closePopUp() {
        document.getElementById("popup").style.display = "none";
      }

      // 구매 버튼이 실행하는 함수
      function verifyAccount(event) {
        if (event) event.preventDefault();
        fetch("www.google.com").then((data) => {
          console.log(data);
        });
        /*   if (event) event.preventDefault();
        // 큐잇 클라이언트가 사용 가능한 경우
        if (
          typeof QueueIt !== "undefined" &&
          typeof QueueIt.validateUser === "function"
        ) {
          const wasUserAlreadyQueued = window.myQueueClient != null;
          storeTrigger = false; // 매장찾기 대기실 에 대한 트리거, 활성화됨
          addOnTrigger = true; // AddOn에 대한 트리거, 비활성화됨
          saveLocalStorage();
          QueueIt.validateUser(); // 규칙이 일치하면 결국 restoreAndSubmitForm()을 호출함
          const isUserQueuedAfterValidation = window.myQueueClient != null;
          // 큐 규칙이 일치하지 않고 클라이언트가 생성되지 않은 경우, 수동으로 restore를 호출함
          if (!wasUserAlreadyQueued && !isUserQueuedAfterValidation) {
            restoreAndSubmitForm();
          }
        } else {
          restoreAndSubmitForm();
        } */
      }

      // 폰 선택 및 사양을 로컬에 저장하는 함수
      function saveLocalStorage() {
        const form = document.getElementById("phone-form");
        const formData = new FormData(form);
        const formObject = {};
        for (const [key, value] of formData.entries()) {
          formObject[key] = value;
        }
        localStorage.setItem("phoneFormData", JSON.stringify(formObject));
      }

      // 로컬 스토리지에서 휴대폰 선택 값을 가져오고 폼을 제출하는 함수
      function restoreAndSubmitForm() {
        const storedData = localStorage.getItem("phoneFormData");
        if (!storedData) return;

        const formObject = JSON.parse(storedData);
        const form = document.getElementById("phone-form");
        for (const key in formObject) {
          const input = form.elements[key];
          if (input) input.value = formObject[key];
        }
        submitForm();
      }

      // 폼을 제출하는 함수, 이 경우에는 테스트를 위해 파라미터를 포함한 URL을 호출함. 삼성 케이스로는 POST API
      function submitForm() {
        const form = document.getElementById("phone-form");
        const formData = new FormData(form);
        const params = new URLSearchParams();

        for (const [key, value] of formData.entries()) {
          params.append(key, value);
        }

        const url = "https://melonaster3.github.io/test2/?" + params.toString();
        window.location.href = url;
      }

      // 이 부분은 무시. 선택 항목이 저장되고 확인되는지 확인하기 위한 용도
      function updateBuyButtonState() {
        const colorSelected = document.querySelector(
          'input[name="color"]:checked'
        );
        const storageSelected = document.querySelector(
          'input[name="storage"]:checked'
        );
        const buyButton = document.getElementById("buy-button");
        buyButton.disabled = !(colorSelected && storageSelected);
      }

      document.addEventListener("DOMContentLoaded", function () {
        updateBuyButtonState();
        // DOM이 로드될 때, URL을 확인하여 Queue-it에서 리디렉션된 것이라면 관련 함수를 호출하여 활성화함
        if (areQueueItParamsPresent()) {
          if (waitingRoomName && waitingRoomName === "javascript") {
            openPopUp();
          } else if (waitingRoomName && waitingRoomName === "javascript2") {
            restoreAndSubmitForm();
          }
        }
        restoreDate();
      });

      // 이 부분도 모두 무시. 폼과 웹사이트용으로 사용됨
      document.querySelectorAll(".options").forEach((group) => {
        group.addEventListener("click", function (e) {
          const label = e.target.closest("label.option-box");
          if (!label) return;

          const inputs = group.querySelectorAll('input[type="radio"]');
          inputs.forEach((input) =>
            input.closest("label").classList.remove("selected")
          );

          const input = label.querySelector('input[type="radio"]');
          if (input) {
            input.checked = true;
            input.addEventListener("change", updateBuyButtonState);
          }

          label.classList.add("selected");
          updateBuyButtonState();
        });
      });

      function restoreDate() {
        // 이 부분도 모두 무시. 폼과 웹사이트용으로 사용됨
        const storedData = localStorage.getItem("phoneFormData");
        if (storedData) {
          const formObject = JSON.parse(storedData);

          ["color", "storage"].forEach((name) => {
            const value = formObject[name];
            if (value) {
              const input = document.querySelector(
                `input[name="${name}"][value="${value}"]`
              );
              if (input) {
                input.checked = true;
                input.closest("label").classList.add("selected");
              }
            }
          });

          updateBuyButtonState();
        }
      }
    </script>
  </body>
</html>
